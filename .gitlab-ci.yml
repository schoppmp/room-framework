variables:
  REGISTRY: gitlab.informatik.hu-berlin.de:4567

build_all:
  image: $REGISTRY/ti/software/bazel-builder:latest
  stage: build
  script:
    - bazel build ...

deploy:
  image: $REGISTRY/ti/software/bazel-builder:latest
  stage: deploy
  services:
    - docker:dind
  script:
    - bazel run -c opt //sparse_linear_algebra:all_images
    - docker images | grep "$REGISTRY/$CI_PROJECT_PATH" | cut -d" " -f1 | while read image; do docker push $image; done